<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ohio Trading & Exchange Co.</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Dust overlay -->
  <div class="dust"></div>

  <!-- Red emergency light -->
  <div class="emergency-light"></div>

  <!-- Title sign -->
  <header class="header">
    <h1 class="title">OHIO TRADING & EXCHANGE CO.</h1>
    <p class="subtitle">BUNKER VAULT VALUES • 28 NOV 2025</p>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="vault">VAULT</button>
    <button class="tab" data-tab="calc">TRADE CALCULATOR</button>
  </div>

  <!-- Search -->
  <div class="search">
    <input type="text" id="search" placeholder="SEARCH VAULT..." autocomplete="off">
  </div>

  <!-- Vault Tab -->
  <main id="vault" class="tab-content active">
    <div id="content"></div>
  </main>

  <!-- Trade Calculator Tab -->
  <div id="calc" class="tab-content">
    <div class="calc-container">
      <div class="side giving">
        <h2>GIVING</h2>
        <div id="giving-items"></div>
        <input type="text" id="give-input" placeholder="+ ADD SKIN (type name)" autocomplete="off">
        <div class="total">TOTAL: <span id="give-total">$0</span></div>
      </div>

      <div class="vs">⟷</div>

      <div class="side receiving">
        <h2>RECEIVING</h2>
        <div id="receive-items"></div>
        <input type="text" id="receive-input" placeholder="+ ADD SKIN (type name)" autocomplete="off">
        <div class="total">TOTAL: <span id="receive-total">$0</span></div>
      </div>
    </div>
    <div id="verdict">—</div>
  </div>

  <script src="skins.js"></script>
  <script>
    const skins = embeddedSkins || [];
    const content = document.getElementById("content");
    const searchInput = document.getElementById("search");

    // === TABS ===
    document.querySelectorAll(".tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    // === GROUPING (exact original order) ===
    const order = ["Invisible","Obsidian","Dark Matter","Anti Matter","Crimson Bloods","Void Reapers","Underworld","White Ghost","Solid Gold","Gift Wrapped","Christmas Future","Golden Snow","Frozen Gold","Sub Zero","Rainbow Firework","Solid Gold V2","St Patrick","Holy Fire","Bloody Heart","Fallout","Atomic Pumpkin","Ethereal","Spectral","Balloon"];
    const groups = [];
    const used = new Set();
    order.forEach(p => {
      const list = skins.filter(s => !used.has(s.name) && s.name.includes(p));
      list.forEach(s => used.add(s.name));
      if (list.length) groups.push({name: p, items: list});
    });
    const leftovers = skins.filter(s => !used.has(s.name));
    if (leftovers.length) groups.push({name: "Limited / Event", items: leftovers});

    function format(v) {
      if (v === 0) return "Unrated";
      if (v >= 1000000) return "$" + (v/1000000).toFixed(1) + "M";
      if (v >= 1000) return "$" + Math.floor(v/1000) + "K";
      return "$" + v;
    }

    function render() {
      const q = searchInput.value.toLowerCase();
      content.innerHTML = "";
      groups.forEach(g => {
        const filtered = g.items.filter(s => s.name.toLowerCase().includes(q));
        if (!filtered.length) return;
        content.innerHTML += `
          <div class="category">
            <h2>${g.name} <span>[${filtered.length}]</span></h2>
            <div class="grid">
              ${filtered.map(s => `
                <div class="card">
                  <div class="name">${s.name}</div>
                  <div class="value">${format(s.worth)}</div>
                  <div class="demand">Demand: ${s.demand === "?" ? "???" : s.demand+"/10"}</div>
                </div>
              `).join("")}
            </div>
          </div>
        `;
      });
    }
    searchInput.addEventListener("input", render);
    render();

    // === TRADE CALCULATOR (NOW 100% WORKING) ===
    const giveItems = document.getElementById("giving-items");
    const receiveItems = document.getElementById("receive-items");
    const giveTotal = document.getElementById("give-total");
    const receiveTotal = document.getElementById("receive-total");
    const verdict = document.getElementById("verdict");

    function addItem(input, container) {
      const val = input.value.trim();
      if (!val) return;
      const match = skins.find(s => s.name.toLowerCase().includes(val.toLowerCase()));
      if (!match) return;

      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `<span>${match.name}</span><span>${format(match.worth)}</span><button>×</button>`;
      div.querySelector("button").onclick = () => { div.remove(); update(); };
      container.appendChild(div);
      input.value = "";
      update();
    }

    document.getElementById("give-input").addEventListener("keydown", e => e.key === "Enter" && addItem(e.target, giveItems));
    document.getElementById("receive-input").addEventListener("keydown", e => e.key === "Enter" && addItem(e.target, receiveItems));

    function getWorth(container) {
      return Array.from(container.children).reduce((sum, el) => {
        const text = el.children[1].textContent;
        if (text === "Unrated") return sum;
        const n = parseFloat(text.replace(/[$,MK]/g, ""));
        return sum + (text.includes("M") ? n*1000000 : text.includes("K") ? n*1000 : n);
      }, 0);
    }

    function update() {
      const give = getWorth(giveItems);
      const receive = getWorth(receiveItems);
      giveTotal.textContent = format(give);
      receiveTotal.textContent = format(receive);

      if (give + receive === 0) {
        verdict.textContent = "—";
        verdict.style.color = "#888";
        return;
      }

      const pct = give === 0 ? Infinity : ((receive - give) / give) * 100;
      let msg, color;
      if (Math.abs(pct) <= 12) { msg = "FAIR"; color = "#fff"; }
      else if (pct > 12) { msg = `GOOD +${pct.toFixed(0)}%`; color = "#0f0"; }
      else if (pct > -30) { msg = "SLIGHT L"; color = "#ff0"; }
      else { msg = "BAD TRADE"; color = "#f00"; }

      verdict.textContent = msg;
      verdict.style.color = color;
    }
  </script>
</body>
</html>
